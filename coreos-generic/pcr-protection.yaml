apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: master
  name: 99-disk-encryption-rebind-master
spec:
  config:
    ignition:
      version: 3.2.0
    storage:
      files:
      - contents:
          source: data:text/plain;charset=utf-8;base64,REVCVUc9InRydWUiClJFU0VSVkVEX1NMT1Q9MzEKQ0xFVklTX0NPTkZJR19SRVNFUlZFRF9TTE9UPSIkUkVTRVJWRURfU0xPVDogdHBtMiAne1wiaGFzaFwiOlwic2hhMjU2XCIsXCJrZXlcIjpcImVjY1wifSciClRSVUU9MApGQUxTRT0xCk5FV0xJTkU9JCdcbicKCiNzZXQgLXgKCiMgbG9nIGZ1bmN0aW9uLiBUYWtlcyAyIGFyZ3VtZW50czoKIyBsb2cgbGV2ZWw6IGRlYnVnIG9yIGluZm8KIyBzdHJpbmcgdG8gcHJpbnQKbG9nKCkgewogICAgY2FzZSAkMSBpbgogICAgImRlYnVnIikKICAgICAgICBlY2hvICJERUJVRyAtICQyIiA+JjIKICAgICAgICA7OwogICAgImluZm8iKQogICAgICAgIGVjaG8gIklORk8gLSAkMiIgPiYyCiAgICAgICAgOzsKICAgICopCiAgICAgICAgIyBDb2RlIHRvIGV4ZWN1dGUgd2hlbiBubyBwYXR0ZXJucyBtYXRjaAogICAgICAgIDs7CiAgICBlc2FjCn0KCiMgbG9ncyBhIHN0cmluZyB3aXRoIGEgZGVidWcgbGV2ZWwKbG9nRGVidWcoKSB7CiAgICBpZiAhIFsgLXYgREVCVUcgXSB8fCAoWyAtdiBERUJVRyBdICYmIFsgIiRERUJVRyIgPT0gInRydWUiIF0pOyB0aGVuCiAgICAgICAgbG9nICJkZWJ1ZyIgIiQxIgogICAgZmkKfQoKIyBsb2dzIGEgc3RyaW5nIHdpdGggYSBpbmZvIGxldmVsCmxvZ0luZm8oKSB7CiAgICBsb2cgImluZm8iICIkMSIKfQoKIyByZXR1cm4gJFRSVUUgaWQgdGhlIHRlbXBvcmFyeSByZXNlcnZlZCBzbG90IGlzIGNvbmZpZ3VyZWQgd2l0aCBhIGtleSAodG8gZGlzYWJsZSBQQ1IgcHJvdGVjdGlvbiksIHJldHVybnMgJEZBTFNFIG90aGVyd2lzZQppc1Jlc2VydmVkU2xvdFByZXNlbnQoKSB7CiAgICBSRVNVTFQ9JChjbGV2aXMgbHVrcyBsaXN0IC1kICQxIC1zICRSRVNFUlZFRF9TTE9UIHx8IHRydWUpCiAgICBpZiBbIC1uICIkUkVTVUxUIiBdICYmIFsgIiRSRVNVTFQiID09ICIkQ0xFVklTX0NPTkZJR19SRVNFUlZFRF9TTE9UIiBdOyB0aGVuCiAgICAgICAgbG9nRGVidWcgInJlc2VydmVkIHNsb3QgJFJFU0VSVkVEX1NMT1QgaXMgcHJlc2VudCIKICAgICAgICByZXR1cm4gJFRSVUUKICAgIGZpCiAgICBsb2dEZWJ1ZyAicmVzZXJ2ZWQgc2xvdCAkUkVTRVJWRURfU0xPVCBpcyBub3QgcHJlc2VudCIKICAgIHJldHVybiAkRkFMU0UKfQoKIyBjcmVhdGUgYSB0ZW1wb3Jhcnkga2V5IGluIHRoZSByZXNlcnZlZCBzbG90IHRvIGRpc2FibGUgUENSIHByb3RlY3Rpb24KYWRkUmVzZXJ2ZWRTbG90KCkgewogICAgbG9nSW5mbyAicmVzZXJ2ZWRTbG90UHJlc2VudD0kMSBkZXZpY2U9JDIgc2xvdD0kMyB3aXRoIFBDUiBJRHM9JDQgYW5kIGNsZXZpcyBjb25maWc9JDUiCiAgICBpZiBbICQxID09ICRUUlVFIF07IHRoZW4KICAgICAgICBsb2dJbmZvICJyZXNlcnZlIHNsb3QgYWxyZWFkeSBwcmVzZW50LCBubyBuZWVkIHRvIGFkZCBhZ2FpbiIKICAgICAgICBjbGV2aXMgbHVrcyBsaXN0IC1kICQyIHx8IHRydWUKICAgICAgICByZXR1cm4KICAgIGZpCiAgICBsb2dJbmZvICJhZGRpbmcgcmVzZXJ2ZWQgc2xvdCBvbiBkZXZpY2U9JGRldmljZSIKICAgIEFOWVBBU1M9IjEyMzQ1Njc4OTAiCiAgICBlY2hvIC1lICIkQU5ZUEFTU1xuIiB8IGNsZXZpcyBsdWtzIGJpbmQgLXMgJFJFU0VSVkVEX1NMT1QgLWQgJDIgdHBtMiAne30nIHx8IHRydWUKICAgIGNsZXZpcyBsdWtzIGxpc3QgLWQgJDIgfHwgdHJ1ZQp9CgojIHJlbW92ZSB0aGUgdGVtcG9yYXJ5IGtleSBpbiB0aGUgcmVzZXJ2ZWQgc2xvdCB0byBlbmFibGUgUENSIHByb3RlY3Rpb24KcmVtb3ZlUmVzZXJ2ZWRTbG90KCkgewogICAgbG9nSW5mbyAicmVtb3ZpbmcgbHVrcyByZXNlcnZlZCBzbG90IDMxIGluIGRpc2sgJDEiCiAgICBlY2hvICJjbGV2aXMgbHVrcyB1bmJpbmQgLXMgJFJFU0VSVkVEX1NMT1QgLWQgJDEgLWYiIHwgc2VkICdzQC9AXC9AZycgfCBiYXNoIHx8IHRydWUKfQoKI2dldHMgdGhlIGxpc3Qgb2YgbHVrcyBkZXZpY2VzIGluIHRoZSBzeXN0ZW0KZ2V0TFVLU0RldmljZXMoKSB7CiAgICByZXN1bHRzPSQobHNibGsgLS1mcyAtbCB8IGdyZXAgY3J5cHRvX0xVS1MgfCBhd2sgJ3twcmludGYgIi9kZXYvIiAkMSAifCJ9JykKICAgIGxvZ0RlYnVnICJnb3QgbHVrcyBkZXZpY2VzIGFjcm9zcyBhbGwgZHJpdmVzOiAkcmVzdWx0cyIKICAgIGVjaG8gJHJlc3VsdHMKfQoKIyBjcmVhdGUgYSBsaXN0IG9mIHNsb3QgY29uZmlndXJhdGlvbiBmb3IgYWxsIGVuY3J5cHRlZCBkZXZpY2VzIGluIHRoZSBzeXN0ZW0KcGFyc2VDbGV2aXNDb25maWcoKSB7CiAgICBsdWtzRGV2aWNlcz0kMQogICAgSUZTPSJ8IgogICAgZm9yIGRldmljZSBpbiAkbHVrc0RldmljZXM7IGRvCiAgICAgICAgbG9nRGVidWcgImRldmljZT0kZGV2aWNlIgogICAgICAgIGlzUmVzZXJ2ZWRTbG90UHJlc2VudCAkZGV2aWNlCiAgICAgICAgaXNSZXNlcnZlZD0kPwogICAgICAgIHBjclNsb3RzPSQoZ2V0UGNyU2xvdHNGb3JEZXZpY2UgJGRldmljZSkKICAgICAgICBsb2dEZWJ1ZyAicGNyU2xvdHM9JHBjclNsb3RzIgogICAgICAgIHBhcnNlQ2xldmlzUmVnZXggIiRwY3JTbG90cyIgJGlzUmVzZXJ2ZWQgIiRkZXZpY2UiCiAgICBkb25lCn0KCmdldFBjclNsb3RzRm9yRGV2aWNlKCkgewogICAgZGV2aWNlPSQxCiAgICBsb2dEZWJ1ZyAiZ2V0UGNyU2xvdHNGb3JEZXZpY2UsIGRldmljZT0kZGV2aWNlIgogICAgY2xldmlzIGx1a3MgbGlzdCAtZCAkZGV2aWNlIHwgZ3JlcCBwY3JfaWRzIHx8IHRydWUKfQoKcGFyc2VDbGV2aXNSZWdleCgpIHsKICAgIElGUz0kJ1xuJwogICAgZm9yIGxpbmUgaW4gJDE7IGRvCiAgICAgICAgbG9nRGVidWcgImxpbmU9JGxpbmUiCiAgICAgICAgZWNobyAiJGxpbmUiIHwgc2VkIC1FICdzQChbMC05XSspKDpccysuKitccysnXCcnKShceykoLio/InBjcl9pZHMiOiIpKC4qKSgiLiopKFx9KSgnXCcnLiopQCckMid8JyQzJ3xcMXxcNXxcM1w0XDVcNlw3QCcKICAgIGRvbmUKfQoKIyBleGVjdXRlcyBhIGZ1bmN0aW9uIHBvaW50ZXIgcGFzc2VkIGFyZ3VtZW50ICQxIGZvciBlYWNoIHNsb3QgY29uZmlndXJlZCB3aXRoIFBDUiBhbmQKIyBmb3IgZXZlcnkgZGV2aWNlIGluIHRoZSBzeXN0ZW0KcHJvY2Vzc1BDUmVudHJpZXNPbmx5KCkgewogICAgbHVrc0RldmljZXM9JChnZXRMVUtTRGV2aWNlcykKICAgIHBhcnNlZENsZXZpcz0kKHBhcnNlQ2xldmlzQ29uZmlnICRsdWtzRGV2aWNlcykKICAgIGlmIFsgIiRwYXJzZWRDbGV2aXMiID09ICIiIF07IHRoZW4KICAgICAgICBsb2dJbmZvICJubyBwY3IgY29uZmlnIGRldGVjdGVkLCBub3RoaW5nIHRvIGRvIGZvciAkMSIKICAgICAgICByZXR1cm4KICAgIGZpCiAgICBsb2dJbmZvICJwYXJzZWQgY2xldmlzIGZvciBhbGwgZHJpdmVzOiAkcGFyc2VkQ2xldmlzIgogICAgZWNobyAiJHBhcnNlZENsZXZpcyIgfCB3aGlsZSBJRlM9IHJlYWQgLXIgbGluZTsgZG8KICAgICAgICBsb2dEZWJ1ZyAiJGxpbmUiCiAgICAgICAgSUZTPSJ8IiByZWFkIC1yYSB2YWx1ZXMgPDw8IiRsaW5lIgogICAgICAgIHJlc2VydmVkU2xvdFByZXNlbnQ9JHt2YWx1ZXNbMF19CiAgICAgICAgZGV2aWNlPSR7dmFsdWVzWzFdfQogICAgICAgIHNsb3ROdW1iZXI9JHt2YWx1ZXNbMl19CiAgICAgICAgcGNySURzPSR7dmFsdWVzWzNdfQogICAgICAgIGNsZXZpc0NvbmZpZz0ke3ZhbHVlc1s0XX0KICAgICAgICBsb2dJbmZvICJyZXNlcnZlZFNsb3Q9JHJlc2VydmVkU2xvdFByZXNlbnQgZGV2aWNlPSRkZXZpY2Ugc2xvdD0kc2xvdE51bWJlciB3aXRoIFBDUiBJRHM9JHBjcklEcyBhbmQgY2xldmlzIGNvbmZpZz0kY2xldmlzQ29uZmlnIgogICAgICAgIGlmIFsgLW4gIiRwY3JJRHMiIF07IHRoZW4KICAgICAgICAgICAgbG9nRGVidWcgImJlZm9yZSBhcHBseWluZyBjb21tYW5kOiAkKC91c3IvYmluL3RwbTJfcGNycmVhZCBzaGEyNTY6JHBjcklEcykiCiAgICAgICAgICAgICQxICRyZXNlcnZlZFNsb3RQcmVzZW50ICRkZXZpY2UgJHNsb3ROdW1iZXIgJHBjcklEcyAkY2xldmlzQ29uZmlnIHx8IHRydWUKICAgICAgICAgICAgbG9nRGVidWcgImFmdGVyIGFwcGx5aW5nIGNvbW1hbmQ6ICQoL3Vzci9iaW4vdHBtMl9wY3JyZWFkIHNoYTI1NjokcGNySURzKSIKICAgICAgICBmaQogICAgZG9uZQp9CgojIGluaXRpYWxpemUgdGhlIGFycmF5IG9mIHVwZ3JhZGUgZGV0ZWN0aW9uIG1ldGhvZHMgc2VydmVyVXBkYXRlRGV0ZWN0aW9uTWV0aG9kcwppbml0VXBncmFkZURldGVjdGlvbk1ldGhvZHMoKSB7CiAgICBmb3IgZiBpbiAkU0NSSVBUX0RJUi9od3VwZ3JhZGUtZGV0ZWN0aW9uLW1ldGhvZHMvKi5zaDsgZG8gc291cmNlICRmOyBkb25lCiAgICBsb2dJbmZvICJkZXRlY3RlZCBzeXN0ZW0gdXBncmFkZSBkZXRlY3Rpb246IgogICAgZm9yIGVsZW1lbnQgaW4gIiR7c2VydmVyVXBkYXRlRGV0ZWN0aW9uTWV0aG9kc1tAXX0iOyBkbyBlY2hvICIkZWxlbWVudCI7IGRvbmUKfQoKIyBleGVjdXRlIGFsbCBodyB1cGdyYWRlIGRldGVjdGlvbiBmdW5jdGlvbnMgaW4gaHd1cGdyYWRlLWRldGVjdGlvbi1tZXRob2RzIGRpcmVjdG9yeQojIHJldHVybnMgdHJ1ZSBpZiBhIGh3IHVwZ3JhZGUgaXMgZGV0ZWN0ZWQKIyBmYWxzZSBvdGhlcndpc2UKaXNTeXN0ZW1VcGRhdGluZygpIHsKICAgIGlzVXBkYXRpbmc9JEZBTFNFCiAgICAjIEl0ZXJhdGUgdGhyb3VnaCB0aGUgdXBkYXRlZCBhcnJheSBhbmQgY2FsbCBlYWNoIGZ1bmN0aW9uCiAgICBmb3IgZnVuYyBpbiAiJHtzZXJ2ZXJVcGRhdGVEZXRlY3Rpb25NZXRob2RzW0BdfSI7IGRvCiAgICAgICAgaWYgJGZ1bmM7IHRoZW4KICAgICAgICAgICAgaXNVcGRhdGluZz0kVFJVRQogICAgICAgICAgICBsb2dJbmZvICJkZXRlY3RlZCB1cGRhdGUgdmlhICRmdW5jIgogICAgICAgIGZpCiAgICBkb25lCiAgICByZXR1cm4gJGlzVXBkYXRpbmcKfQoKI3JlYmluZHMgYSBnaXZlbiBrZXkgc2xvdCB0aGF0IGlzIGNvbmZpZ3VyZWQgd2l0aCBQQ1IgZm9yIGEgZ2l2ZW4gZGV2aWNlCnJlYmluZFBDUmVudHJpZXNPbmx5KCkgewogICAgbG9nSW5mbyAiUmViaW5kaW5nIHJlc2VydmVkU2xvdFByZXNlbnQ9JDEgZGV2aWNlPSQyIHNsb3Q9JDMgd2l0aCBQQ1IgSURzPSQ0IGFuZCBjbGV2aXMgY29uZmlnPSQ1IgogICAgY2xldmlzLWx1a3MtcmVnZW4gLWQgJDIgLXMgJDMgLXEgfHwgdHJ1ZQogICAgcmVtb3ZlUmVzZXJ2ZWRTbG90ICQyCn0K
        mode: 493
        path: /usr/local/bin/luks-helpers.sh
      - contents:
          source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKU0NSSVBUX0RJUj0kKGRpcm5hbWUgIiQwIikKc291cmNlICRTQ1JJUFRfRElSL2x1a3MtaGVscGVycy5zaAoKbG9nSW5mbyAiU2h1dHRpbmcgZG93biBvciByZWJvb3RpbmciCmluaXRVcGdyYWRlRGV0ZWN0aW9uTWV0aG9kcwppZiBpc1N5c3RlbVVwZGF0aW5nOyB0aGVuCiAgICBsb2dJbmZvICJTeXN0ZW0gSFcgdXBkYXRlIGRldGVjdGVkLCBkaXNhYmxpbmcgUENSIHByb3RlY3Rpb24gb24gYWxsIFBDUiBwcm90ZWN0ZWQgTFVLUyBwYXJ0aXRpb25zIgogICAgcHJvY2Vzc1BDUmVudHJpZXNPbmx5IGFkZFJlc2VydmVkU2xvdAogICAgZXhpdCAwCmZpCgpsb2dJbmZvICJObyBTeXN0ZW0gSFcgdXBkYXRlIGRldGVjdGVkLCBjb250aW51ZSIK
        mode: 493
        path: /usr/local/bin/disablePcrOnRebootOrShutdown.sh
      - contents:
          source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKU0NSSVBUX0RJUj0kKGRpcm5hbWUgIiQwIikKc291cmNlICRTQ1JJUFRfRElSL2x1a3MtaGVscGVycy5zaAojc2V0IC14Cgpsb2dJbmZvICJib290aW5nLi4uIGNoZWNraW5nIGlmIHJlYmluZGluZyBkaXNrIG5lZWRlZCIKcHJvY2Vzc1BDUmVudHJpZXNPbmx5IHJlYmluZFBDUmVudHJpZXNPbmx5CmV4aXQgMAoKbG9nSW5mbyAiUENSIGNvbmZpZ3VyYXRpb24gYWxyZWFkeSBwcmVzZW50IGFuZCByZXNlcnZlZCBzbG90IG5vdCBwcmVzZW50LCBjb250aW51ZSBib290Igo=
        mode: 493
        path: /usr/local/bin/rebindDiskOnBoot.sh
      - contents:
          source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKCmlzQ3VzdG9tRmlsZVVwZGF0aW5nKCkgewogICAgaWYgWyAtZiAiL2V0Yy9ob3N0LWh3LVVwZGF0aW5nLmZsYWciIF07IHRoZW4KICAgICAgICByZXR1cm4gJFRSVUUKICAgIGVsc2UKICAgICAgICByZXR1cm4gJEZBTFNFCiAgICBmaQp9CgojIEFkZCBhIG5ldyBmdW5jdGlvbiB0byB0aGUgYXJyYXkgb2YgdXBkYXRlIGRldGVjdGlvbiBtZXRob2RzCnNlcnZlclVwZGF0ZURldGVjdGlvbk1ldGhvZHMrPSgiaXNDdXN0b21GaWxlVXBkYXRpbmciKQo=
        mode: 493
        path: /usr/local/bin/hwupgrade-detection-methods/file.sh
      - contents:
          source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKCmlzRnd1cFVwZGF0aW5nKCkgewogICAgRUZJPSQoZWZpYm9vdG1ncikKICAgIE5FWFRfQk9PVD0kKGVjaG8gJEVGSSB8IGdyZXAgIkJvb3ROZXh0OiIgfCBhd2sgeydwcmludCAkMid9KQogICAgaWYgWyAiJE5FWFRfQk9PVCIgPT0gIiIgXTsgdGhlbgogICAgICAgIHJldHVybiAxCiAgICBmaQogICAgRldVUEQ9JChlY2hvICRFRkkgfCBncmVwICJCb290JE5FWFRfQk9PVCIgfCBncmVwICJmd3VwZCIpCiAgICAjIGlmIHRoZSBuZXh0IGJvb3QgbGluZSBjb250YWlucyB0aGUgdGV4dCAiZnd1cGQiCiAgICBpZiBbICQ/IF07IHRoZW4KICAgICAgICByZXR1cm4gJFRSVUUKICAgIGZpCiAgICByZXR1cm4gJEZBTFNFCn0KCiMgQWRkIGEgbmV3IGZ1bmN0aW9uIHRvIHRoZSBhcnJheSBvZiB1cGRhdGUgZGV0ZWN0aW9uIG1ldGhvZHMKc2VydmVyVXBkYXRlRGV0ZWN0aW9uTWV0aG9kcys9KCJpc0Z3dXBVcGRhdGluZyIpCg==
        mode: 493
        path: /usr/local/bin/hwupgrade-detection-methods/fwup.sh
      - contents:
          source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKCmlzT3N0cmVlVXBkYXRpbmcoKSB7CiAgICBSRVNVTFQ9JChvc3RyZWUgYWRtaW4gc3RhdHVzIHwgZ3JlcCAtRSAic3RhZ2VkfHBlbmRpbmciKQogICAgaWYgWyAiJFJFU1VMVCIgIT0gIiIgXTsgdGhlbgogICAgICAgIHJldHVybiAkVFJVRQogICAgZWxzZQogICAgICAgIHJldHVybiAkRkFMU0UKICAgIGZpCn0KCiMgQWRkIGEgbmV3IGZ1bmN0aW9uIHRvIHRoZSBhcnJheSBvZiB1cGRhdGUgZGV0ZWN0aW9uIG1ldGhvZHMKc2VydmVyVXBkYXRlRGV0ZWN0aW9uTWV0aG9kcys9KCJpc09zdHJlZVVwZGF0aW5nIikK
        mode: 493
        path: /usr/local/bin/hwupgrade-detection-methods/ostree.sh
      - contents:
          source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKClNQT0tFX0tVQkVDT05GSUdfUEFUSD0vdmFyL2xpYi9rdWJlbGV0L2t1YmVjb25maWcKSFVCX1NFQ1JFVF9OQU1FU1BBQ0U9b3Blbi1jbHVzdGVyLW1hbmFnZW1lbnQtYWdlbnQKSFVCX1NFQ1JFVF9OQU1FPWh1Yi1rdWJlY29uZmlnLXNlY3JldAoKIyByZXRyaWV2ZXMgdGhlIGt1YmVjb25maWcgZm9yIHRoaXMgc3Bva2UncyBjbHVzdGVyCmdldEh1Ykt1YmVjb25maWcoKSB7CiAgICBLVUJFQ09ORklHX0RBVEE9JChvYyAtLWt1YmVjb25maWcgJDEgZ2V0IHNlY3JldCAtbiAkMiAkMyAtbyBqc29uIHwganEgLmRhdGEua3ViZWNvbmZpZyB8IHNlZCAncy8iLy9nJyB8IGJhc2U2NCAtZCkKICAgIGlmIFsgLXogIiRLVUJFQ09ORklHX0RBVEEiIF07IHRoZW4KICAgICAgICByZXR1cm4gJEZBTFNFCiAgICBmaQogICAgVExTX0tFWT0kKG9jIC0ta3ViZWNvbmZpZyAkMSBnZXQgc2VjcmV0IC1uICQyICQzIC1vIGpzb24gfCBqcSAnLmRhdGEuInRscy5rZXkiJyB8IHNlZCAncy8iLy9nJykKICAgIFRMU19DUlQ9JChvYyAtLWt1YmVjb25maWcgJDEgZ2V0IHNlY3JldCAtbiAkMiAkMyAtbyBqc29uIHwganEgJy5kYXRhLiJ0bHMuY3J0IicgfCBzZWQgJ3MvIi8vZycpCiAgICBlY2hvICIkS1VCRUNPTkZJR19EQVRBIiB8IHNlZCAtZSAicy9jbGllbnQtY2VydGlmaWNhdGU6IHRscy5jcnQvY2xpZW50LWNlcnRpZmljYXRlLWRhdGE6ICRUTFNfQ1JUL2ciIHwgc2VkIC1lICJzL2NsaWVudC1rZXk6IHRscy5rZXkvY2xpZW50LWtleS1kYXRhOiAkVExTX0tFWS9nIiA+L3RtcC9rdWJlY29uZmlnLWh1YgogICAgcmV0dXJuICRUUlVFCn0KCiMgUmV0cmVpdmVzIFRBTE0ncyBzdGF0ZSBpbiB0aGUgaHViIGNsdXN0ZXIncyBtYW5hZ2VkQ2x1c3RlciBvYmplY3QuIFRha2VzIG9uZSBhcmd1bWVudDoKIyBkb25lIC0+IHJldHVybiAkVFJVRSBpZiB0aGUgenRwLWRvbmUgbGFiZWwgaXMgc2V0LCAkRkFMU0Ugb3RoZXJ3aXNlCiMgcnVubmluZyAtPiByZXR1cm4gJFRSVUUgaWYgdGhlIHp0cC1ydW5uaW5nIGxhYmVsIGlzIHNldCwgJEZBTFNFIG90aGVyd2lzZQppc1p0cFN0YXRlKCkgewogICAgc3Bva2VDbHVzdGVyTmFtZT0kKGhvc3RuYW1lIC0tc2hvcnQpCiAgICBSRVNVTFQ9JEZBTFNFCiAgICBjYXNlICQxIGluCiAgICAicnVubmluZyIpCiAgICAgICAgUkVTVUxUPSQoS1VCRUNPTkZJRz0vdG1wL2t1YmVjb25maWctaHViIG9jIGdldCBtYW5hZ2VkY2x1c3RlciAkKGhvc3RuYW1lIC0tc2hvcnQpIC1vanNvbiB8IGpxICcubWV0YWRhdGEubGFiZWxzWyJ6dHAtcnVubmluZyJdIT1udWxsJykKICAgICAgICA7OwogICAgImRvbmUiKQogICAgICAgIFJFU1VMVD0kKEtVQkVDT05GSUc9L3RtcC9rdWJlY29uZmlnLWh1YiBvYyBnZXQgbWFuYWdlZGNsdXN0ZXIgJChob3N0bmFtZSAtLXNob3J0KSAtb2pzb24gfCBqcSAnLm1ldGFkYXRhLmxhYmVsc1sienRwLWRvbmUiXSE9bnVsbCcpCiAgICAgICAgOzsKICAgICopCiAgICAgICAgIyBDb2RlIHRvIGV4ZWN1dGUgd2hlbiBubyBwYXR0ZXJucyBtYXRjaAogICAgICAgIDs7CiAgICBlc2FjCiAgICBpZiBbICIkUkVTVUxUIiA9PSAiZmFsc2UiIF07IHRoZW4KICAgICAgICBsb2dEZWJ1ZyAiVEFMTSAkMSBzdGF0ZSBpcyAkUkVTVUxUIgogICAgICAgIHJldHVybiAkRkFMU0UKICAgIGZpCiAgICBsb2dEZWJ1ZyAiVEFMTSAkMSBzdGF0ZSBpcyAkUkVTVUxUIgogICAgcmV0dXJuICRUUlVFCn0KCmlzVEFMTVVwZGF0aW5nKCkgewogICAgaWYgISBnZXRIdWJLdWJlY29uZmlnICRTUE9LRV9LVUJFQ09ORklHX1BBVEggJEhVQl9TRUNSRVRfTkFNRVNQQUNFICRIVUJfU0VDUkVUX05BTUU7IHRoZW4KICAgICAgICBsb2dJbmZvICJUQUxNIG5vdCBhdmFpbGFibGUgb3IgaHViIGt1YmVjb25maWcgaXMgbm8gcmVhZHkgeWV0IGF0ICRTUE9LRV9LVUJFQ09ORklHX1BBVEggcGF0aCwgY2Fubm90IGdldCBzcG9rZSBzZWNyZXQgJEhVQl9TRUNSRVRfTkFNRSBpbiAkSFVCX1NFQ1JFVF9OQU1FU1BBQ0UgbmFtZXNwYWNlIgogICAgICAgIHJldHVybiAkRkFMU0UKICAgIGZpCiAgICBpc1p0cFN0YXRlICJydW5uaW5nIgogICAgcmV0dXJuICQ/Cn0KCiMgQWRkIGEgbmV3IGZ1bmN0aW9uIHRvIHRoZSBhcnJheSBvZiB1cGRhdGUgZGV0ZWN0aW9uIG1ldGhvZHMKc2VydmVyVXBkYXRlRGV0ZWN0aW9uTWV0aG9kcys9KCJpc1RBTE1VcGRhdGluZyIpCg==
        mode: 493
        path: /usr/local/bin/hwupgrade-detection-methods/talm.sh
    systemd:
      units:
      - contents: |
          [Unit]
          After=cryptsetup.target systemd-boot-update.service
          Requires=cryptsetup.target systemd-boot-update.service
          RequiredBy=sysinit.target
          [Service]
          Type=oneshot
          ExecStart=/usr/local/bin/rebindDiskOnBoot.sh
          [Install]
          RequiredBy=sysinit.target
        enabled: true
        name: pcr-rebind-boot.service
      - contents: |
          [Service]
          Type=oneshot
          RemainAfterExit=true
          ExecStart=/usr/bin/true
          ExecStop=/usr/local/bin/disablePcrOnRebootOrShutdown.sh
          [Install]
          WantedBy=multi-user.target
        enabled: true
        name: pcr-disable-shutdown.service
