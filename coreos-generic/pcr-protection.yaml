apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: master
  name: 99-disk-encryption-rebind-master
spec:
  config:
    ignition:
      version: 3.2.0
    storage:
      files:
      - contents:
          source: data:text/plain;charset=utf-8;base64,REVCVUc9InRydWUiClJFU0VSVkVEX1NMT1Q9MzEKQ0xFVklTX0NPTkZJR19SRVNFUlZFRF9TTE9UPSIkUkVTRVJWRURfU0xPVDogdHBtMiAne1wiaGFzaFwiOlwic2hhMjU2XCIsXCJrZXlcIjpcImVjY1wifSciClRSVUU9MApGQUxTRT0xCk5FV0xJTkU9JCdcbicKCiNzZXQgLXgKCiMgbG9nIGZ1bmN0aW9uLiBUYWtlcyAyIGFyZ3VtZW50czoKIyBsb2cgbGV2ZWw6IGRlYnVnIG9yIGluZm8KIyBzdHJpbmcgdG8gcHJpbnQKbG9nKCkgewogICAgY2FzZSAkMSBpbgogICAgImRlYnVnIikKICAgICAgICBlY2hvICJERUJVRyAtICQyIiA+JjIKICAgICAgICA7OwogICAgImluZm8iKQogICAgICAgIGVjaG8gIklORk8gLSAkMiIgPiYyCiAgICAgICAgOzsKICAgICopCiAgICAgICAgIyBDb2RlIHRvIGV4ZWN1dGUgd2hlbiBubyBwYXR0ZXJucyBtYXRjaAogICAgICAgIDs7CiAgICBlc2FjCn0KCiMgbG9ncyBhIHN0cmluZyB3aXRoIGEgZGVidWcgbGV2ZWwKbG9nRGVidWcoKSB7CiAgICBpZiAhIFsgLXYgREVCVUcgXSB8fCAoWyAtdiBERUJVRyBdICYmIFsgIiRERUJVRyIgPT0gInRydWUiIF0pOyB0aGVuCiAgICAgICAgbG9nICJkZWJ1ZyIgIiQxIgogICAgZmkKfQoKIyBsb2dzIGEgc3RyaW5nIHdpdGggYSBpbmZvIGxldmVsCmxvZ0luZm8oKSB7CiAgICBsb2cgImluZm8iICIkMSIKfQoKIyByZXR1cm4gJFRSVUUgaWQgdGhlIHRlbXBvcmFyeSByZXNlcnZlZCBzbG90IGlzIGNvbmZpZ3VyZWQgd2l0aCBhIGtleSAodG8gZGlzYWJsZSBQQ1IgcHJvdGVjdGlvbiksIHJldHVybnMgJEZBTFNFIG90aGVyd2lzZQppc1Jlc2VydmVkU2xvdFByZXNlbnQoKSB7CiAgICBSRVNVTFQ9JChjbGV2aXMgbHVrcyBsaXN0IC1kICQxIC1zICRSRVNFUlZFRF9TTE9UKQogICAgaWYgWyAtbiAiJFJFU1VMVCIgXSAmJiBbICIkUkVTVUxUIiA9PSAiJENMRVZJU19DT05GSUdfUkVTRVJWRURfU0xPVCIgXTsgdGhlbgogICAgICAgIGxvZ0RlYnVnICJyZXNlcnZlZCBzbG90ICRSRVNFUlZFRF9TTE9UIGlzIHByZXNlbnQiCiAgICAgICAgcmV0dXJuICRUUlVFCiAgICBmaQogICAgbG9nRGVidWcgInJlc2VydmVkIHNsb3QgJFJFU0VSVkVEX1NMT1QgaXMgbm90IHByZXNlbnQiCiAgICByZXR1cm4gJEZBTFNFCn0KCiMgY3JlYXRlIGEgdGVtcG9yYXJ5IGtleSBpbiB0aGUgcmVzZXJ2ZWQgc2xvdCB0byBkaXNhYmxlIFBDUiBwcm90ZWN0aW9uCmFkZFJlc2VydmVkU2xvdCgpIHsKICAgIGxvZ0luZm8gInJlc2VydmVkU2xvdFByZXNlbnQ9JDEgZGV2aWNlPSQyIHNsb3Q9JDMgd2l0aCBQQ1IgSURzPSQ0IGFuZCBjbGV2aXMgY29uZmlnPSQ1IgogICAgaWYgWyAkMSA9PSAkVFJVRSBdOyB0aGVuCiAgICAgICAgbG9nSW5mbyAicmVzZXJ2ZSBzbG90IGFscmVhZHkgcHJlc2VudCwgbm8gbmVlZCB0byBhZGQgYWdhaW4iCiAgICAgICAgcmV0dXJuCiAgICBmaQogICAgbG9nSW5mbyAiYWRkaW5nIHJlc2VydmVkIHNsb3Qgb24gZGV2aWNlPSRkZXZpY2UiCiAgICBBTllQQVNTPSIxMjM0NTY3ODkwIgogICAgZWNobyAtZSAiJEFOWVBBU1NcbiIgfCBjbGV2aXMgbHVrcyBiaW5kIC1zICRSRVNFUlZFRF9TTE9UIC1kICQyIHRwbTIgJ3t9JwogICAgY2xldmlzIGx1a3MgbGlzdCAtZCAkMgp9CgojIHJlbW92ZSB0aGUgdGVtcG9yYXJ5IGtleSBpbiB0aGUgcmVzZXJ2ZWQgc2xvdCB0byBlbmFibGUgUENSIHByb3RlY3Rpb24KcmVtb3ZlUmVzZXJ2ZWRTbG90KCkgewogICAgbG9nSW5mbyAicmVtb3ZpbmcgbHVrcyByZXNlcnZlZCBzbG90IDMxIGluIGRpc2sgJDEiCiAgICBlY2hvICJjbGV2aXMgbHVrcyB1bmJpbmQgLXMgJFJFU0VSVkVEX1NMT1QgLWQgJDEgLWYiIHwgc2VkICdzQC9AXC9AZycgfCBiYXNoCn0KCiNnZXRzIHRoZSBsaXN0IG9mIGx1a3MgZGV2aWNlcyBpbiB0aGUgc3lzdGVtCmdldExVS1NEZXZpY2VzKCkgewogICAgcmVzdWx0cz0kKGxzYmxrIC0tZnMgLWwgfCBncmVwIGNyeXB0b19MVUtTIHwgYXdrICd7cHJpbnRmICIvZGV2LyIgJDEgInwifScpCiAgICBsb2dEZWJ1ZyAiZ290IGx1a3MgZGV2aWNlcyBhY3Jvc3MgYWxsIGRyaXZlczogJHJlc3VsdHMiCiAgICBlY2hvICRyZXN1bHRzCn0KCiMgY3JlYXRlIGEgbGlzdCBvZiBzbG90IGNvbmZpZ3VyYXRpb24gZm9yIGFsbCBlbmNyeXB0ZWQgZGV2aWNlcyBpbiB0aGUgc3lzdGVtCnBhcnNlQ2xldmlzQ29uZmlnKCkgewogICAgbHVrc0RldmljZXM9JDEKICAgIElGUz0ifCIKICAgIGZvciBkZXZpY2UgaW4gJGx1a3NEZXZpY2VzOyBkbwogICAgICAgIGxvZ0RlYnVnICJkZXZpY2U9JGRldmljZSIKICAgICAgICBpc1Jlc2VydmVkU2xvdFByZXNlbnQgJGRldmljZQogICAgICAgIGlzUmVzZXJ2ZWQ9JD8KICAgICAgICBwY3JTbG90cz0kKGdldFBjclNsb3RzRm9yRGV2aWNlICRkZXZpY2UpCiAgICAgICAgbG9nRGVidWcgInBjclNsb3RzPSRwY3JTbG90cyIKICAgICAgICBwYXJzZUNsZXZpc1JlZ2V4ICIkcGNyU2xvdHMiICRpc1Jlc2VydmVkICIkZGV2aWNlIgogICAgZG9uZQp9CgpnZXRQY3JTbG90c0ZvckRldmljZSgpIHsKICAgIGRldmljZT0kMQogICAgbG9nRGVidWcgImdldFBjclNsb3RzRm9yRGV2aWNlLCBkZXZpY2U9JGRldmljZSIKICAgIGNsZXZpcyBsdWtzIGxpc3QgLWQgJGRldmljZSB8IGdyZXAgcGNyX2lkcwp9CgpwYXJzZUNsZXZpc1JlZ2V4KCkgewogICAgSUZTPSQnXG4nCiAgICBmb3IgbGluZSBpbiAkMTsgZG8KICAgICAgICBsb2dEZWJ1ZyAibGluZT0kbGluZSIKICAgICAgICBlY2hvICIkbGluZSIgfCBzZWQgLUUgJ3NAKFswLTldKykoOlxzKy4qK1xzKydcJycpKFx7KSguKj8icGNyX2lkcyI6IikoLiopKCIuKikoXH0pKCdcJycuKilAJyQyJ3wnJDMnfFwxfFw1fFwzXDRcNVw2XDdAJwogICAgZG9uZQp9CgojIGV4ZWN1dGVzIGEgZnVuY3Rpb24gcG9pbnRlciBwYXNzZWQgYXJndW1lbnQgJDEgZm9yIGVhY2ggc2xvdCBjb25maWd1cmVkIHdpdGggUENSIGFuZAojIGZvciBldmVyeSBkZXZpY2UgaW4gdGhlIHN5c3RlbQpwcm9jZXNzUENSZW50cmllc09ubHkoKSB7CiAgICBsdWtzRGV2aWNlcz0kKGdldExVS1NEZXZpY2VzKQogICAgcGFyc2VkQ2xldmlzPSQocGFyc2VDbGV2aXNDb25maWcgJGx1a3NEZXZpY2VzKQogICAgaWYgWyAiJHBhcnNlZENsZXZpcyIgPT0gIiIgXTsgdGhlbgogICAgICAgIGxvZ0luZm8gIm5vIHBjciBjb25maWcgZGV0ZWN0ZWQsIG5vdGhpbmcgdG8gZG8gZm9yICQxIgogICAgICAgIHJldHVybgogICAgZmkKICAgIGxvZ0luZm8gInBhcnNlZCBjbGV2aXMgZm9yIGFsbCBkcml2ZXM6ICRwYXJzZWRDbGV2aXMiCiAgICBlY2hvICIkcGFyc2VkQ2xldmlzIiB8IHdoaWxlIElGUz0gcmVhZCAtciBsaW5lOyBkbwogICAgICAgIGxvZ0RlYnVnICIkbGluZSIKICAgICAgICBJRlM9InwiIHJlYWQgLXJhIHZhbHVlcyA8PDwiJGxpbmUiCiAgICAgICAgcmVzZXJ2ZWRTbG90UHJlc2VudD0ke3ZhbHVlc1swXX0KICAgICAgICBkZXZpY2U9JHt2YWx1ZXNbMV19CiAgICAgICAgc2xvdE51bWJlcj0ke3ZhbHVlc1syXX0KICAgICAgICBwY3JJRHM9JHt2YWx1ZXNbM119CiAgICAgICAgY2xldmlzQ29uZmlnPSR7dmFsdWVzWzRdfQogICAgICAgIGxvZ0luZm8gInJlc2VydmVkU2xvdD0kcmVzZXJ2ZWRTbG90UHJlc2VudCBkZXZpY2U9JGRldmljZSBzbG90PSRzbG90TnVtYmVyIHdpdGggUENSIElEcz0kcGNySURzIGFuZCBjbGV2aXMgY29uZmlnPSRjbGV2aXNDb25maWciCiAgICAgICAgaWYgWyAtbiAiJHBjcklEcyIgXTsgdGhlbgogICAgICAgICAgICAkMSAkcmVzZXJ2ZWRTbG90UHJlc2VudCAkZGV2aWNlICRzbG90TnVtYmVyICRwY3JJRHMgJGNsZXZpc0NvbmZpZwogICAgICAgIGZpCiAgICBkb25lCn0KCiMgaW5pdGlhbGl6ZSB0aGUgYXJyYXkgb2YgdXBncmFkZSBkZXRlY3Rpb24gbWV0aG9kcyBzZXJ2ZXJVcGRhdGVEZXRlY3Rpb25NZXRob2RzCmluaXRVcGdyYWRlRGV0ZWN0aW9uTWV0aG9kcygpIHsKICAgIGZvciBmIGluICRTQ1JJUFRfRElSL2h3dXBncmFkZS1kZXRlY3Rpb24tbWV0aG9kcy8qLnNoOyBkbyBzb3VyY2UgJGY7IGRvbmUKICAgIGxvZ0luZm8gImRldGVjdGVkIHN5c3RlbSB1cGdyYWRlIGRldGVjdGlvbjoiCiAgICBmb3IgZWxlbWVudCBpbiAiJHtzZXJ2ZXJVcGRhdGVEZXRlY3Rpb25NZXRob2RzW0BdfSI7IGRvIGVjaG8gIiRlbGVtZW50IjsgZG9uZQp9CgojIGV4ZWN1dGUgYWxsIGh3IHVwZ3JhZGUgZGV0ZWN0aW9uIGZ1bmN0aW9ucyBpbiBod3VwZ3JhZGUtZGV0ZWN0aW9uLW1ldGhvZHMgZGlyZWN0b3J5CiMgcmV0dXJucyB0cnVlIGlmIGEgaHcgdXBncmFkZSBpcyBkZXRlY3RlZAojIGZhbHNlIG90aGVyd2lzZQppc1N5c3RlbVVwZGF0aW5nKCkgewogICAgaXNVcGRhdGluZz0kRkFMU0UKICAgICMgSXRlcmF0ZSB0aHJvdWdoIHRoZSB1cGRhdGVkIGFycmF5IGFuZCBjYWxsIGVhY2ggZnVuY3Rpb24KICAgIGZvciBmdW5jIGluICIke3NlcnZlclVwZGF0ZURldGVjdGlvbk1ldGhvZHNbQF19IjsgZG8KICAgICAgICBpZiAkZnVuYzsgdGhlbgogICAgICAgICAgICBpc1VwZGF0aW5nPSRUUlVFCiAgICAgICAgICAgIGxvZ0luZm8gImRldGVjdGVkIHVwZGF0ZSB2aWEgJGZ1bmMiCiAgICAgICAgZmkKICAgIGRvbmUKICAgIHJldHVybiAkaXNVcGRhdGluZwp9CgojcmViaW5kcyBhIGdpdmVuIGtleSBzbG90IHRoYXQgaXMgY29uZmlndXJlZCB3aXRoIFBDUiBmb3IgYSBnaXZlbiBkZXZpY2UKcmViaW5kUENSZW50cmllc09ubHkoKSB7CiAgICBsb2dJbmZvICJSZWJpbmRpbmcgcmVzZXJ2ZWRTbG90UHJlc2VudD0kMSBkZXZpY2U9JDIgc2xvdD0kMyB3aXRoIFBDUiBJRHM9JDQgYW5kIGNsZXZpcyBjb25maWc9JDUiCiAgICBjbGV2aXMtbHVrcy1lZGl0IC1kICQyIC1zICQzIC1jICIkNSIKICAgIHJlbW92ZVJlc2VydmVkU2xvdCAkMgp9Cg==
        mode: 493
        path: /usr/local/bin/luks-helpers.sh
      - contents:
          source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKU0NSSVBUX0RJUj0kKGRpcm5hbWUgIiQwIikKc291cmNlICRTQ1JJUFRfRElSL2x1a3MtaGVscGVycy5zaAoKbG9nSW5mbyAiU2h1dHRpbmcgZG93biBvciByZWJvb3RpbmciCmluaXRVcGdyYWRlRGV0ZWN0aW9uTWV0aG9kcwppZiBpc1N5c3RlbVVwZGF0aW5nOyB0aGVuCiAgICBsb2dJbmZvICJTeXN0ZW0gSFcgdXBkYXRlIGRldGVjdGVkLCBkaXNhYmxpbmcgUENSIHByb3RlY3Rpb24gb24gYWxsIFBDUiBwcm90ZWN0ZWQgTFVLUyBwYXJ0aXRpb25zIgogICAgcHJvY2Vzc1BDUmVudHJpZXNPbmx5IGFkZFJlc2VydmVkU2xvdAogICAgZXhpdCAwCmZpCgpsb2dJbmZvICJObyBTeXN0ZW0gSFcgdXBkYXRlIGRldGVjdGVkLCBjb250aW51ZSIK
        mode: 493
        path: /usr/local/bin/disablePcrOnRebootOrShutdown.sh
      - contents:
          source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKU0NSSVBUX0RJUj0kKGRpcm5hbWUgIiQwIikKc291cmNlICRTQ1JJUFRfRElSL2x1a3MtaGVscGVycy5zaAojc2V0IC14Cgpsb2dJbmZvICJib290aW5nLi4uIGNoZWNraW5nIGlmIHJlYmluZGluZyBkaXNrIG5lZWRlZCIKY2xldmlzIGx1a3MgbGlzdCAtZCAvZGV2L2Rpc2svYnktcGFydGxhYmVsL3Jvb3QgLXMgJFJFU0VSVkVEX1NMT1QKcHJvY2Vzc1BDUmVudHJpZXNPbmx5IHJlYmluZFBDUmVudHJpZXNPbmx5CmV4aXQgMAoKbG9nSW5mbyAiUENSIGNvbmZpZ3VyYXRpb24gYWxyZWFkeSBwcmVzZW50IGFuZCByZXNlcnZlZCBzbG90IG5vdCBwcmVzZW50LCBjb250aW51ZSBib290Igo=
        mode: 493
        path: /usr/local/bin/rebindDiskOnBoot.sh
      - contents:
          source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKCmlzQ3VzdG9tRmlsZVVwZGF0aW5nKCkgewogICAgaWYgWyAtZiAiL2V0Yy9ob3N0LWh3LVVwZGF0aW5nLmZsYWciIF07IHRoZW4KICAgICAgICByZXR1cm4gJFRSVUUKICAgIGVsc2UKICAgICAgICByZXR1cm4gJEZBTFNFCiAgICBmaQp9CgojIEFkZCBhIG5ldyBmdW5jdGlvbiB0byB0aGUgYXJyYXkgb2YgdXBkYXRlIGRldGVjdGlvbiBtZXRob2RzCnNlcnZlclVwZGF0ZURldGVjdGlvbk1ldGhvZHMrPSgiaXNDdXN0b21GaWxlVXBkYXRpbmciKQo=
        mode: 493
        path: /usr/local/bin/hwupgrade-detection-methods/file.sh
      - contents:
          source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKCmlzRnd1cFVwZGF0aW5nKCkgewogICAgRUZJPSQoZWZpYm9vdG1ncikKICAgIE5FWFRfQk9PVD0kKGVjaG8gJEVGSSB8IGdyZXAgIkJvb3ROZXh0OiIgfCBhd2sgeydwcmludCAkMid9KQogICAgaWYgWyAiJE5FWFRfQk9PVCIgPT0gIiIgXTsgdGhlbgogICAgICAgIHJldHVybiAxCiAgICBmaQogICAgRldVUEQ9JChlY2hvICRFRkkgfCBncmVwICJCb290JE5FWFRfQk9PVCIgfCBncmVwICJmd3VwZCIpCiAgICAjIGlmIHRoZSBuZXh0IGJvb3QgbGluZSBjb250YWlucyB0aGUgdGV4dCAiZnd1cGQiCiAgICBpZiBbICQ/IF07IHRoZW4KICAgICAgICByZXR1cm4gJFRSVUUKICAgIGZpCiAgICByZXR1cm4gJEZBTFNFCn0KCiMgQWRkIGEgbmV3IGZ1bmN0aW9uIHRvIHRoZSBhcnJheSBvZiB1cGRhdGUgZGV0ZWN0aW9uIG1ldGhvZHMKc2VydmVyVXBkYXRlRGV0ZWN0aW9uTWV0aG9kcys9KCJpc0Z3dXBVcGRhdGluZyIpCg==
        mode: 493
        path: /usr/local/bin/hwupgrade-detection-methods/fwup.sh
      - contents:
          source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKCmlzT3N0cmVlVXBkYXRpbmcoKSB7CiAgICBSRVNVTFQ9JChvc3RyZWUgYWRtaW4gc3RhdHVzIHwgZ3JlcCAtRSAic3RhZ2VkfHBlbmRpbmciKQogICAgaWYgWyAiJFJFU1VMVCIgIT0gIiIgXTsgdGhlbgogICAgICAgIHJldHVybiAkVFJVRQogICAgZWxzZQogICAgICAgIHJldHVybiAkRkFMU0UKICAgIGZpCn0KCiMgQWRkIGEgbmV3IGZ1bmN0aW9uIHRvIHRoZSBhcnJheSBvZiB1cGRhdGUgZGV0ZWN0aW9uIG1ldGhvZHMKc2VydmVyVXBkYXRlRGV0ZWN0aW9uTWV0aG9kcys9KCJpc09zdHJlZVVwZGF0aW5nIikK
        mode: 493
        path: /usr/local/bin/hwupgrade-detection-methods/ostree.sh
      - contents:
          source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKClNQT0tFX0tVQkVDT05GSUdfUEFUSD0vdmFyL2xpYi9rdWJlbGV0L2t1YmVjb25maWcKSFVCX1NFQ1JFVF9OQU1FU1BBQ0U9b3Blbi1jbHVzdGVyLW1hbmFnZW1lbnQtYWdlbnQKSFVCX1NFQ1JFVF9OQU1FPWh1Yi1rdWJlY29uZmlnLXNlY3JldAoKIyByZXRyaWV2ZXMgdGhlIGt1YmVjb25maWcgZm9yIHRoaXMgc3Bva2UncyBjbHVzdGVyCmdldEh1Ykt1YmVjb25maWcoKSB7CiAgICBLVUJFQ09ORklHX0RBVEE9JChvYyAtLWt1YmVjb25maWcgJDEgZ2V0IHNlY3JldCAtbiAkMiAkMyAtbyBqc29uIHwganEgLmRhdGEua3ViZWNvbmZpZyB8IHNlZCAncy8iLy9nJyB8IGJhc2U2NCAtZCkKICAgIGlmIFsgLXogIiRLVUJFQ09ORklHX0RBVEEiIF07IHRoZW4KICAgICAgICByZXR1cm4gJEZBTFNFCiAgICBmaQogICAgVExTX0tFWT0kKG9jIC0ta3ViZWNvbmZpZyAkMSBnZXQgc2VjcmV0IC1uICQyICQzIC1vIGpzb24gfCBqcSAnLmRhdGEuInRscy5rZXkiJyB8IHNlZCAncy8iLy9nJykKICAgIFRMU19DUlQ9JChvYyAtLWt1YmVjb25maWcgJDEgZ2V0IHNlY3JldCAtbiAkMiAkMyAtbyBqc29uIHwganEgJy5kYXRhLiJ0bHMuY3J0IicgfCBzZWQgJ3MvIi8vZycpCiAgICBlY2hvICIkS1VCRUNPTkZJR19EQVRBIiB8IHNlZCAtZSAicy9jbGllbnQtY2VydGlmaWNhdGU6IHRscy5jcnQvY2xpZW50LWNlcnRpZmljYXRlLWRhdGE6ICRUTFNfQ1JUL2ciIHwgc2VkIC1lICJzL2NsaWVudC1rZXk6IHRscy5rZXkvY2xpZW50LWtleS1kYXRhOiAkVExTX0tFWS9nIiA+L3RtcC9rdWJlY29uZmlnLWh1YgogICAgcmV0dXJuICRUUlVFCn0KCiMgUmV0cmVpdmVzIFRBTE0ncyBzdGF0ZSBpbiB0aGUgaHViIGNsdXN0ZXIncyBtYW5hZ2VkQ2x1c3RlciBvYmplY3QuIFRha2VzIG9uZSBhcmd1bWVudDoKIyBkb25lIC0+IHJldHVybiAkVFJVRSBpZiB0aGUgenRwLWRvbmUgbGFiZWwgaXMgc2V0LCAkRkFMU0Ugb3RoZXJ3aXNlCiMgcnVubmluZyAtPiByZXR1cm4gJFRSVUUgaWYgdGhlIHp0cC1ydW5uaW5nIGxhYmVsIGlzIHNldCwgJEZBTFNFIG90aGVyd2lzZQppc1p0cFN0YXRlKCkgewogICAgUkVTVUxUPSRGQUxTRQogICAgY2FzZSAkMSBpbgogICAgInJ1bm5pbmciKQogICAgICAgIFJFU1VMVD0kKEtVQkVDT05GSUc9L3RtcC9rdWJlY29uZmlnLWh1YiBvYyBnZXQgbWFuYWdlZGNsdXN0ZXIgc25vMiAtb2pzb24gfCBqcSAnLm1ldGFkYXRhLmxhYmVsc1sienRwLXJ1bm5pbmciXSE9bnVsbCcpCiAgICAgICAgOzsKICAgICJkb25lIikKICAgICAgICBSRVNVTFQ9JChLVUJFQ09ORklHPS90bXAva3ViZWNvbmZpZy1odWIgb2MgZ2V0IG1hbmFnZWRjbHVzdGVyIHNubzIgLW9qc29uIHwganEgJy5tZXRhZGF0YS5sYWJlbHNbInp0cC1kb25lIl0hPW51bGwnKQogICAgICAgIDs7CiAgICAqKQogICAgICAgICMgQ29kZSB0byBleGVjdXRlIHdoZW4gbm8gcGF0dGVybnMgbWF0Y2gKICAgICAgICA7OwogICAgZXNhYwogICAgaWYgWyAiJFJFU1VMVCIgPT0gImZhbHNlIiBdOyB0aGVuCiAgICAgICAgbG9nRGVidWcgIlRBTE0gJDEgc3RhdGUgaXMgJFJFU1VMVCIKICAgICAgICByZXR1cm4gJEZBTFNFCiAgICBmaQogICAgbG9nRGVidWcgIlRBTE0gJDEgc3RhdGUgaXMgJFJFU1VMVCIKICAgIHJldHVybiAkVFJVRQp9Cgppc1RBTE1VcGRhdGluZygpIHsKICAgIGlmICEgZ2V0SHViS3ViZWNvbmZpZyAkU1BPS0VfS1VCRUNPTkZJR19QQVRIICRIVUJfU0VDUkVUX05BTUVTUEFDRSAkSFVCX1NFQ1JFVF9OQU1FOyB0aGVuCiAgICAgICAgbG9nSW5mbyAiVEFMTSBub3QgYXZhaWxhYmxlIG9yIGh1YiBrdWJlY29uZmlnIGlzIG5vIHJlYWR5IHlldCBhdCAkU1BPS0VfS1VCRUNPTkZJR19QQVRIIHBhdGgsIGNhbm5vdCBnZXQgc3Bva2Ugc2VjcmV0ICRIVUJfU0VDUkVUX05BTUUgaW4gJEhVQl9TRUNSRVRfTkFNRVNQQUNFIG5hbWVzcGFjZSIKICAgICAgICByZXR1cm4gJEZBTFNFCiAgICBmaQogICAgaXNadHBTdGF0ZSAicnVubmluZyIKICAgIHJldHVybiAkPwp9CgojIEFkZCBhIG5ldyBmdW5jdGlvbiB0byB0aGUgYXJyYXkgb2YgdXBkYXRlIGRldGVjdGlvbiBtZXRob2RzCnNlcnZlclVwZGF0ZURldGVjdGlvbk1ldGhvZHMrPSgiaXNUQUxNVXBkYXRpbmciKQo=
        mode: 493
        path: /usr/local/bin/hwupgrade-detection-methods/talm.sh
    systemd:
      units:
      - contents: |
          [Unit]
          After=cryptsetup.target
          [Service]
          Type=oneshot
          ExecStart=/usr/local/bin/rebindDiskOnBoot.sh
          [Install]
          WantedBy=multi-user.target
        enabled: true
        name: pcr-rebind-boot.service
      - contents: |
          [Unit]
          DefaultDependencies=no
          [Service]
          Type=simple
          ExecStart=/usr/local/bin/disablePcrOnRebootOrShutdown.sh
          [Install]
          WantedBy=shutdown.target reboot.target halt.target
        enabled: true
        name: pcr-disable-shutdown.service
